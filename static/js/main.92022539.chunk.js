(this["webpackJsonpleansync-demo"]=this["webpackJsonpleansync-demo"]||[]).push([[0],{17:function(e,t,n){e.exports=n(30)},22:function(e,t,n){},23:function(e,t,n){},24:function(e,t,n){},25:function(e,t,n){},27:function(e,t,n){},30:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(15),s=n.n(a),i=(n(22),n(23),n(5)),u=(n(24),n(25),n(8)),o=function(e){return c.a.createElement("div",{className:"server-note"},e.noteText)},l=function(e){var t=e.notes.map((function(e,t){return c.a.createElement(o,{key:t,noteText:e.text})})),n=u.a.map((function(e){return c.a.createElement("option",{value:e},e)}));return c.a.createElement("div",{className:"computer server"},c.a.createElement("h2",{className:"computer-header"},"Server"),c.a.createElement("label",null,"Conflict Resolution Strategy",c.a.createElement("select",{onChange:function(t){e.dispatch({type:"setResolutionStrategy",strategy:t.target.value})}},n)),c.a.createElement("div",{className:"computer-wrapper server-wrapper"},c.a.createElement("div",{className:"server-notes"},t)))},f=n(2),d=(n(27),n(3)),p=n(4),v=n(11),y=n(6),h=n(9),m=n(10),b=n(1),w=n.n(b);function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;return{id:Object(m.v1)().toString(),text:e,updatedAt:t}}var x=function(e){function t(){return Object(d.a)(this,t),Object(v.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(p.a)(t,null,[{key:"createPopulated",value:function(e,n){for(var r=new t,c=1;c<=e;c++)r.add(g("Note ".concat(c),n),n);return r}}]),t}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return Object(m.v1)().toString()};Object(d.a)(this,e),this.newKey=n,this.rows=void 0,this.clone=function(e){return e.map((function(e){return Object.assign({},e)}))},this.rows=this.clone(t)}return Object(p.a)(e,[{key:"getByKey",value:function(e){var t;return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=this.rows.filter((function(t){return e.includes(t.id)})),n.abrupt("return",this.clone(t));case 2:case"end":return n.stop()}}),null,this)}},{key:"getSyncedSince",value:function(e){var t;return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=this.rows.filter((function(t){return!e||t.syncedAt&&t.syncedAt>e})),n.abrupt("return",this.clone(t));case 2:case"end":return n.stop()}}),null,this)}},{key:"update",value:function(e,t,n){var r,c,a,s,i,u,o;return w.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:for((r=this.rows.find((function(t){return t.id==(n||e.id)})))||(r={},this.rows.push(r)),c=!0,a=!1,s=void 0,l.prev=5,i=Object.keys(e)[Symbol.iterator]();!(c=(u=i.next()).done);c=!0)o=u.value,r[o]=e[o];l.next=13;break;case 9:l.prev=9,l.t0=l.catch(5),a=!0,s=l.t0;case 13:l.prev=13,l.prev=14,c||null==i.return||i.return();case 16:if(l.prev=16,!a){l.next=19;break}throw s;case 19:return l.finish(16);case 20:return l.finish(13);case 21:return r.syncedAt=t,l.abrupt("return",Object.assign(r,{}));case 23:case"end":return l.stop()}}),null,this,[[5,9,13,21],[14,,16,20]])}},{key:"add",value:function(e,t){var n;return w.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:for((n=Object.assign({},e)).syncedAt=t;this.rows.some((function(e){return e.id==n.id}));)n.id=this.newKey();return this.rows.push(n),r.abrupt("return",Object.assign({},n));case 5:case"end":return r.stop()}}),null,this)}},{key:"getRequiringSync",value:function(){var e;return w.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.rows.filter((function(e){return!e.syncedAt||e.updatedAt>e.syncedAt})),t.abrupt("return",this.clone(e));case 2:case"end":return t.stop()}}),null,this)}},{key:"MarkConflicted",value:function(e){var t;return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:(t=this.rows.find((function(t){return t.id==e.id})))&&(t.conflict=JSON.stringify(e));case 2:case"end":return n.stop()}}),null,this)}}]),e}()),S=n(16),E=n.n(S),O=function(e){var t=e.hasChanges,n=E()({"client-note":!0,hasChanges:t});return c.a.createElement("textarea",{value:e.noteText,onChange:function(t){return e.onChange(t.target.value)},className:n})},k=function(e){var t=Object(r.useState)(e.notes),n=Object(i.a)(t,2),a=n[0],s=n[1],u=a.map((function(t,n){var r,i=e.notes.length>n&&e.notes[n],u=!i||t.text!=i.text;return c.a.createElement(O,{key:t.id,noteText:t.text,hasChanges:u,onChange:(r=n,function(e){var t=a.slice(),n=Object(f.a)({},t[r]);n.text=e,t[r]=n,s(t)})})}));return c.a.createElement("div",{className:"computer client"},c.a.createElement("h2",{className:"computer-header"},"Client",c.a.createElement("a",{className:"remove",title:"Remove Client",onClick:function(){e.dispatch({type:"removeClient",clientIndex:e.clientIndex})}},String.fromCharCode(10008))),c.a.createElement("label",null,c.a.createElement("input",{type:"checkbox",onClick:function(){e.dispatch({type:"setClientOffline",clientIndex:e.clientIndex,isOffline:!e.isOffline})}}),"Is Offline"),c.a.createElement("div",{className:"computer-wrapper client-wrapper"},c.a.createElement("div",{className:"client-notes"},u),c.a.createElement("div",{className:"client-buttons"},c.a.createElement("button",{onClick:function(){var e=a.slice();e.push(g("")),s(e)}},"New"),c.a.createElement("button",{onClick:function(){e.dispatch({type:"requestSync",clientIndex:e.clientIndex,clientNotes:a})}},"Sync"))))};var j={server:{notes:[],resolutionStrategy:"takeClient"},clients:[]};function C(e,t){var n;switch(t.type){case"setResolutionStrategy":n=function(e,t){var n=Object(f.a)({},e);return n.server=Object(f.a)({},e.server,{resolutionStrategy:t}),n}(e,t.strategy);break;case"addClient":n=function(e){var t=Object(f.a)({},e);return t.clients=e.clients.slice(),t.clients.push({notes:[]}),t}(e);break;case"removeClient":n=function(e,t){var n=Object(f.a)({},e);return n.clients=e.clients.slice(),n.clients.splice(t,1),n}(e,t.clientIndex);break;case"setClientOffline":n=function(e,t,n){var r=Object(f.a)({},e);return r.clients=e.clients.slice(),r.clients[t]=Object(f.a)({},e.clients[t],{isOffline:n}),r}(e,t.clientIndex,t.isOffline);break;case"requestSync":n=function(e,t,n){var r=Object(f.a)({},e),c={clientIndex:t,clientNotes:n};return r.syncRequest=c,r}(e,t.clientIndex,t.clientNotes);break;case"processSync":n=function(e,t,n,r,c){var a=Object(f.a)({},e),s=Object(f.a)({},a.server);s.notes=r;var i=a.clients.slice(),u=Object(f.a)({},i[t]);return u.notes=n,u.lastSync=c,i[t]=u,a.clients=i,a.server=s,delete a.syncRequest,a}(e,t.clientIndex,t.clientNotes,t.serverNotes,t.syncStamp);break;default:!function(e){throw new Error("Unexpected object: "+e)}(t)}return n}var N=function(){var e=Object(r.useReducer)(C,j),t=Object(i.a)(e,2),n=t[0],a=t[1];Object(r.useEffect)((function(){n.syncRequest&&function(e,t,n){var r,c,a,s,i,o,l,f,d;return w.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:return r=new x(e.server.notes),c=new x(n),a={entityKey:function(e){return e.id},entityLastUpdated:function(e){return e.updatedAt},areEntitiesEqual:function(e,t){return e.text==t.text},getServerEntities:function(e){return r.getByKey(e)},getServerEntitiesSyncedSince:function(e){return r.getSyncedSince(e)},updateServerEntity:function(e,t){return r.update(e,t)},createServerEntity:function(e,t){return r.add(e,t)},conflictResolutionStrategy:e.server.resolutionStrategy},s=new u.c(a),i=e.clients[t],o=new Date,l={keySelector:function(e){return e.id},getClientEntitiesRequiringSync:c.getRequiringSync.bind(c),getClientEntities:c.getByKey,getLastSyncStamp:function(){return w.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.lastSync);case 1:case"end":return e.stop()}}))},markSyncStamp:function(e){return w.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:o=e;case 1:case"end":return t.stop()}}))},updateEntity:function(e,t,n){return w.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:c.update(e,t,n);case 1:case"end":return r.stop()}}))},createEntity:function(e){return w.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:c.add(e);case 1:case"end":return t.stop()}}))},syncWithServer:function(e,t){return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",s.sync(e,t));case 1:case"end":return n.stop()}}))}},f=new u.b(l),p.next=10,w.a.awrap(f.sync());case 10:return d={type:"processSync",clientIndex:t,serverNotes:r.rows,clientNotes:c.rows,syncStamp:o},p.abrupt("return",d);case 12:case"end":return p.stop()}}))}(n,n.syncRequest.clientIndex,n.syncRequest.clientNotes).then((function(e){return a(e)})).catch((function(e){throw e}))}));var s=n.clients.map((function(e,t){return c.a.createElement(k,{key:t,clientIndex:t,notes:e.notes,dispatch:a})}));return c.a.createElement("div",null,c.a.createElement("div",{className:"computers"},c.a.createElement(l,{notes:n.server.notes,resolutionStrategy:n.server.resolutionStrategy,dispatch:a}),s),c.a.createElement("button",{onClick:function(){return a({type:"addClient"})}},"Add Client"))},I=function(){return c.a.createElement("div",{className:"App"},c.a.createElement(N,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(c.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[17,1,2]]]);
//# sourceMappingURL=main.92022539.chunk.js.map