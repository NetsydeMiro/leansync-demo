(this["webpackJsonpleansync-demo"]=this["webpackJsonpleansync-demo"]||[]).push([[0],[,,,,,,,,,,,,function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFNTE3OEEyQTk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFNTE3OEEyQjk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU1MTc4QTI4OTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU1MTc4QTI5OTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+m4QGuQAAAyRJREFUeNrEl21ojWEYx895TDPbMNlBK46IUiNmPvHBSUjaqc0H8pF5+aDUKPEBqU2NhRQpX5Rv5jWlDIWlMCv7MMSWsWwmb3tpXub4XXWdPHvc9/Gc41nu+nedc7/8r/99PffLdYdDPsvkwsgkTBwsA/PADJCnzX2gHTwBt8Hl7p537/3whn04XoDZDcpBlk+9P8AFcAghzRkJwPF4zGGw0Y9QS0mAM2AnQj77FqCzrtcwB1Hk81SYojHK4DyGuQ6mhIIrBWB9Xm7ug/6B/nZrBHBegrkFxoVGpnwBMSLR9EcEcC4qb8pP14BWcBcUgewMnF3T34VqhWMFkThLJAalwnENOAKiHpJq1FZgI2AT6HZtuxZwR9GidSHtI30jOrbawxlVX78/AbNfhHlomEUJJI89O2MqeE79T8/nk8nMBm/dK576hZgmA3cp/R4l9/UeSxiHLVIlNm4nFfT0bxyuIj7LHRTKai+zdJobwMKzcZSJb0ePV5PKN+BqAAKE47UlMnERELMM3EdYP/yrd+XYb2mOiYBiQ8OQnoRBlXrl9JZix7D1pHTazu4MoyBcnYamqAjIMTR8G4FT8LuhLsexXYYjICBiqhQBvYb6fLZIJCjPypVvaOoVAW2WcasCnL2Nq82xHJNSqlCeFcDshaPK0twkAhosjZL31QYw+1rlMpWGMArl23SBsZZO58F2tlJXmjOXS+s4WGvpMiBJT/I2PInZ6lIs9/hBsNS1hS6BG0DSqmYEDRlCXQrmy50P1oDRKTSegmNbUsA0zDMwRhPJXeCE3vWLPQMvan6X8AgIa1vcR4AkGZkDR4ejJ1UHpsaVI0g2LInpOsNFUud1rhxSV+fzC9Woz2EZkWQuja7/B+jUrgtIMpy9YCW4n4K41YfzRneW5E1KJTe4B2Zq1Q5EHEtj4U3AfEzR5SVY4l7QYQPJdN2as7RKBF0BPZqqH4VgMAMBL8Byxr7y8zCZiDlnOcEKIPmUpgB5Z2ww5RdOiiRiNajUmWda5IG6WbhsyY2fx6m8gLcoJDJFkH219M3We1+cnda93pfycZpIJEL/s/wSYADmOAwAQgdpBAAAAABJRU5ErkJggg=="},,,,,,function(e,t,n){e.exports=n(33)},,,,,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,function(e,t,n){},function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(16),s=n.n(a),i=(n(23),n(24),n(25),n(12)),o=n.n(i),u=(n(26),function(){return r.a.createElement("header",null,r.a.createElement("div",null,r.a.createElement("h1",{className:"title is-1"},"LeanSync Demo (Alpha)")),r.a.createElement("div",null,r.a.createElement("a",{href:"https://github.com/NetsydeMiro/leansync"},r.a.createElement("img",{src:o.a,className:"App-logo",alt:"logo"}),"LeanSync Algorithm Repo"),r.a.createElement("br",null),r.a.createElement("a",{href:"https://github.com/NetsydeMiro/leansync-demo"},r.a.createElement("img",{src:o.a,className:"App-logo",alt:"logo"}),"LeanSync Demo Repo")))}),l=n(3),d=(n(27),n(28),n(6)),p=n(4),y=n(5),f=n(11),m=n(7),v=n(9),h=n(10),b=n(1),E=n.n(b);function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;return{id:Object(h.v1)().toString(),text:e,updatedAt:t}}var w=function(e){function t(){return Object(p.a)(this,t),Object(f.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(y.a)(t,null,[{key:"createPopulated",value:function(e,n){for(var c=new t,r=1;r<=e;r++)c.add(g("Note ".concat(r),n),n);return c}}]),t}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return Object(h.v1)().toString()};Object(p.a)(this,e),this.newKey=n,this.rows=void 0,this.clone=function(e){return e.map((function(e){return Object.assign({},e)}))},this.rows=this.clone(t)}return Object(y.a)(e,[{key:"getByKey",value:function(e){var t;return E.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=this.rows.filter((function(t){return e.includes(t.id)})),n.abrupt("return",this.clone(t));case 2:case"end":return n.stop()}}),null,this)}},{key:"getSyncedSince",value:function(e){var t;return E.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=this.rows.filter((function(t){return!e||t.syncedAt&&t.syncedAt>e})),n.abrupt("return",this.clone(t));case 2:case"end":return n.stop()}}),null,this)}},{key:"update",value:function(e,t,n){var c,r,a,s,i,o,u;return E.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:for((c=this.rows.find((function(t){return t.id==(n||e.id)})))||(c={},this.rows.push(c)),r=!0,a=!1,s=void 0,l.prev=5,i=Object.keys(e)[Symbol.iterator]();!(r=(o=i.next()).done);r=!0)u=o.value,c[u]=e[u];l.next=13;break;case 9:l.prev=9,l.t0=l.catch(5),a=!0,s=l.t0;case 13:l.prev=13,l.prev=14,r||null==i.return||i.return();case 16:if(l.prev=16,!a){l.next=19;break}throw s;case 19:return l.finish(16);case 20:return l.finish(13);case 21:return c.syncedAt=t,l.abrupt("return",Object.assign(c,{}));case 23:case"end":return l.stop()}}),null,this,[[5,9,13,21],[14,,16,20]])}},{key:"add",value:function(e,t){var n;return E.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:for((n=Object.assign({},e)).syncedAt=t;this.rows.some((function(e){return e.id==n.id}));)n.id=this.newKey();return this.rows.push(n),c.abrupt("return",Object.assign({},n));case 5:case"end":return c.stop()}}),null,this)}},{key:"getRequiringSync",value:function(){var e;return E.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.rows.filter((function(e){return!e.syncedAt||e.updatedAt>e.syncedAt})),t.abrupt("return",this.clone(e));case 2:case"end":return t.stop()}}),null,this)}},{key:"MarkConflicted",value:function(e){var t;return E.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:(t=this.rows.find((function(t){return t.id==e.id})))&&(t.conflict=JSON.stringify(e));case 2:case"end":return n.stop()}}),null,this)}}]),e}()),S=function(e){return r.a.createElement("div",{className:"server-note"},e.noteText)},A=function(e){var t=Object(c.useState)([]),n=Object(l.a)(t,2),a=n[0],s=n[1],i=a.map((function(e,t){return r.a.createElement(S,{key:t,noteText:e.text})})),o=d.a.map((function(e){return r.a.createElement("option",{value:e},e)}));return Object(c.useEffect)((function(){if(e.syncRequest){var t=new w(a),n={entityKey:function(e){return e.id},entityLastUpdated:function(e){return e.updatedAt},areEntitiesEqual:function(e,t){return e.text==t.text},getServerEntities:t.getByKey.bind(t),getServerEntitiesSyncedSince:t.getSyncedSince.bind(t),updateServerEntity:t.update.bind(t),createServerEntity:t.add.bind(t),conflictResolutionStrategy:e.resolutionStrategy};new d.c(n).sync(e.syncRequest.notes,e.syncRequest.lastSync).then((function(n){s(t.rows),e.dispatch({type:"respondSync",response:n})})).catch((function(e){throw e}))}}),[e.syncRequest]),r.a.createElement("div",{className:"computer server"},r.a.createElement("div",{className:"computer-header"},r.a.createElement("h3",{className:"title is-3"},"Server"),r.a.createElement("button",{className:"button",onClick:function(){return e.dispatch({type:"addClient"})}},"Add Client")),r.a.createElement("div",{className:"computer-wrapper server-wrapper"},r.a.createElement("div",{className:"server-notes"},i),r.a.createElement("div",{id:"resolution-strategy"},r.a.createElement("label",null,"Conflict Resolution Strategy ",r.a.createElement("br",null),r.a.createElement("div",{className:"select"},r.a.createElement("select",{onChange:function(t){e.dispatch({type:"setResolutionStrategy",strategy:t.target.value})}},o))))))},R=n(2),j=(n(32),n(17)),k=n.n(j),x=function(e){var t=k()({"client-note":!0});return r.a.createElement("textarea",{value:e.noteText,onChange:function(t){return e.onChange(t.target.value)},className:t})},O=function(e){var t=Object(c.useState)(),n=Object(l.a)(t,2),a=n[0],s=n[1],i=Object(c.useState)([]),o=Object(l.a)(i,2),u=o[0],p=o[1],y=u.map((function(e,t){return r.a.createElement(x,{key:e.id,noteText:e.text,onChange:(n=t,function(e){var t=u.slice(),c=Object(R.a)({},t[n]);c.text=e,t[n]=c,p(t)})});var n}));return Object(c.useEffect)((function(){if(e.syncResponse){var t=new w(u),n={keySelector:function(e){return e.id},getClientEntitiesRequiringSync:t.getRequiringSync.bind(t),getClientEntities:t.getByKey.bind(t),getLastSyncStamp:function(){return E.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a);case 1:case"end":return e.stop()}}))},markSyncStamp:function(e){return E.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:s(e);case 1:case"end":return t.stop()}}))},updateEntity:function(e,n,c){return E.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:t.update(e,n,c);case 1:case"end":return r.stop()}}))},createEntity:function(e,n){return E.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t.add(e,n);case 1:case"end":return c.stop()}}))},syncWithServer:function(t,n){var c,r;return E.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return c={clientIndex:e.clientIndex,notes:t,lastSync:n},e.dispatch({type:"requestSync",request:c}),r={newEntities:[],syncedEntities:[],conflictedEntities:[],syncStamp:new Date},a.abrupt("return",Promise.resolve(r));case 4:case"end":return a.stop()}}))}};new d.b(n).processSyncResponse(e.syncResponse),p(t.rows),e.dispatch({type:"acknowledgeSync",clientIndex:e.clientIndex})}}),[e.syncResponse]),r.a.createElement("div",{className:"computer client"},r.a.createElement("div",{className:"computer-header"},r.a.createElement("h2",{className:"title is-3"},r.a.createElement("a",{className:"remove",title:"Remove Client",onClick:function(){e.dispatch({type:"removeClient",clientIndex:e.clientIndex})}}),"Client"),r.a.createElement("label",{className:"offline checkbox"},r.a.createElement("input",{type:"checkbox",onClick:function(){e.dispatch({type:"setClientOffline",clientIndex:e.clientIndex,isOffline:!e.isOffline})}}),"Offline")),r.a.createElement("div",{className:"computer-wrapper client-wrapper"},r.a.createElement("div",{className:"client-notes"},y),r.a.createElement("div",{className:"client buttons are-small"},r.a.createElement("button",{title:"Add Note",className:"new button is-success is-outlined",onClick:function(){var e=u.slice();e.push(g("")),p(e)}},r.a.createElement("span",null)),r.a.createElement("button",{title:"Sync Notes",className:"sync button is-link is-outlined",onClick:function(){var t=new w(u),n={keySelector:function(e){return e.id},getClientEntitiesRequiringSync:t.getRequiringSync.bind(t),getClientEntities:t.getByKey.bind(t),getLastSyncStamp:function(){return E.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a);case 1:case"end":return e.stop()}}))},markSyncStamp:function(e){return E.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:s(e);case 1:case"end":return t.stop()}}))},updateEntity:function(e,n,c){return E.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:t.update(e,n,c);case 1:case"end":return r.stop()}}))},createEntity:function(e,n){return E.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t.add(e,n);case 1:case"end":return c.stop()}}))},syncWithServer:function(t,n){var c,r;return E.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return c={clientIndex:e.clientIndex,notes:t,lastSync:n},e.dispatch({type:"requestSync",request:c}),r={newEntities:[],syncedEntities:[],conflictedEntities:[],syncStamp:new Date},a.abrupt("return",Promise.resolve(r));case 4:case"end":return a.stop()}}))}};new d.b(n).sync().then((function(e){console.log(e)})).catch((function(e){throw console.log(e)}))}},r.a.createElement("span",null)))))};var N={server:{resolutionStrategy:"takeClient"},clients:[]};function I(e,t){var n;switch(t.type){case"setResolutionStrategy":n=function(e,t){var n=Object(R.a)({},e);return n.server=Object(R.a)({},e.server,{resolutionStrategy:t}),n}(e,t.strategy);break;case"addClient":n=function(e){var t=Object(R.a)({},e);return t.clients=e.clients.slice(),t.clients.push({}),t}(e);break;case"removeClient":n=function(e,t){var n=Object(R.a)({},e);return n.clients=e.clients.slice(),n.clients.splice(t,1),n}(e,t.clientIndex);break;case"setClientOffline":n=function(e,t,n){var c=Object(R.a)({},e);return c.clients=e.clients.slice(),c.clients[t]=Object(R.a)({},e.clients[t],{isOffline:n}),c}(e,t.clientIndex,t.isOffline);break;case"requestSync":n=function(e,t){var n=Object(R.a)({},e),c=Object(R.a)({},n.server);return c.syncRequest=t,n.server=c,n}(e,t.request);break;case"respondSync":n=function(e,t){if(!e.server.syncRequest)return e;var n=Object(R.a)({},e),c=n.server.syncRequest.clientIndex,r=Object(R.a)({},n.server);delete r.syncRequest,n.server=r,n.clients=n.clients.slice();var a=Object(R.a)({},n.clients[c]);return a.syncResponse=t,n.clients[c]=a,n}(e,t.response);break;case"acknowledgeSync":n=function(e,t){var n=Object(R.a)({},e);n.clients=n.clients.slice();var c=Object(R.a)({},n.clients[t]);return delete c.syncResponse,n.clients[t]=c,n}(e,t.clientIndex);break;default:!function(e){throw new Error("Unexpected object: "+e)}(t)}return n}var B=function(){var e=Object(c.useReducer)(I,N),t=Object(l.a)(e,2),n=t[0],a=t[1],s=n.clients.map((function(e,t){return r.a.createElement(O,{key:t,clientIndex:t,isOffline:e.isOffline,dispatch:a,syncResponse:e.syncResponse})}));return r.a.createElement("div",null,r.a.createElement("div",{className:"computers"},r.a.createElement(A,{resolutionStrategy:n.server.resolutionStrategy,syncRequest:n.server.syncRequest,dispatch:a}),s))},M=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(u,null),r.a.createElement(B,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[18,1,2]]]);
//# sourceMappingURL=main.4704b6ec.chunk.js.map